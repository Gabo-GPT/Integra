<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Integra - Dashboard de Formaci√≥n</title>
  <meta name="theme-color" content="#2a2e36">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/integra.css">
</head>
<body class="integra-dashboard">
  <div id="integraSaveStatus" class="integra-save-status" role="status" aria-live="polite" style="display:none"></div>
  <div id="loginOverlay" class="login-overlay">
    <div class="login-card">
      <div class="login-brand">
        <span class="login-logo">‚óÜ</span>
        <span>INTEGRA</span>
      </div>
      <h2 class="login-title">Portal de Servicios</h2>
      <p class="login-subtitle">Ingresa con tu cuenta institucional</p>
      <form class="login-form" id="loginForm">
        <div class="login-field">
          <label for="loginUsuario">Usuario o correo</label>
          <input type="text" id="loginUsuario" placeholder="ej. 2024001 o estudiante@instituto.edu" autocomplete="username" required>
        </div>
        <div class="login-field">
          <label for="loginPassword">Contrase√±a</label>
          <input type="password" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" required>
        </div>
        <label class="login-remember">
          <input type="checkbox" id="loginRemember" checked>
          <span>Recordar sesi√≥n</span>
        </label>
        <button type="submit" class="login-btn">Iniciar sesi√≥n</button>
      </form>
      <div class="login-links">
        <a href="#" class="login-link">¬øOlvidaste tu contrase√±a?</a>
        <a href="#" class="login-link">¬øEres agente? Reg√≠strate aqu√≠</a>
      </div>
    </div>
    <p class="login-footer">INTEGRA ¬∑ Acceso seguro</p>
  </div>

  <div id="serverWakingOverlay" class="server-waking-overlay hidden" role="status" aria-live="polite">
    <div class="server-waking-card">
      <div class="server-waking-spinner" aria-hidden="true"></div>
      <p class="server-waking-text">Cargando base de datos...</p>
      <p class="server-waking-hint">Espera mientras se obtienen los datos del servidor</p>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-brand">
        <span class="brand-icon">‚óÜ</span>
        <div class="sidebar-brand-text">
          <span class="brand-name">Integra</span>
          <span class="brand-subtitle">Dashboard de Formaci√≥n</span>
        </div>
      </div>
      <button type="button" class="sidebar-toggle" aria-label="Men√∫" id="sidebarToggle">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
      </button>
    </div>
    <nav class="sidebar-nav">
      <a href="#dashboard" class="nav-item active" data-section="dashboard">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="9"/><rect x="14" y="3" width="7" height="5"/><rect x="14" y="12" width="7" height="9"/><rect x="3" y="16" width="7" height="5"/></svg>
        <span>Inicio</span>
      </a>
      <a href="#intermitencia" class="nav-item" data-section="intermitencia" data-qoe-only>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <span>Intermitencia</span>
      </a>
      <a href="#gestion" class="nav-item" data-section="gestion" data-user-only data-hide-for-qoe>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/></svg>
        <span>Mi Gesti√≥n</span>
      </a>
      <a href="#tablero-mensual" class="nav-item" data-section="tablero-mensual" data-user-only>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="12" width="4" height="9"/><rect x="10" y="8" width="4" height="13"/><rect x="17" y="4" width="4" height="17"/></svg>
        <span>Tablero Mensual</span>
      </a>
      <a href="#formacion" class="nav-item" data-section="formacion">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        <span>Formaci√≥n</span>
      </a>
      <a href="#calidad" class="nav-item" data-section="calidad" data-admin-only>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
        <span>Matriz de Calidad</span>
      </a>
      <a href="#bolsa" class="nav-item" data-section="bolsa" data-admin-only>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
        <span>Bolsa</span>
      </a>
      <a href="#bolsa-hfc" class="nav-item" data-section="bolsa-hfc" data-admin-only>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
        <span>Bolsa HFC</span>
      </a>
      <a href="#agentes" class="nav-item" data-section="agentes" data-admin-only>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
        <span>Agentes</span>
      </a>
      <a href="#perfil" class="nav-item" data-section="perfil" data-admin-only>
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
        <span>Perfil</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <span class="version">v1.0</span>
    </div>
  </aside>

  <div class="main-wrap">
    <header class="topbar">
      <button type="button" class="topbar-menu" aria-label="Men√∫" id="topbarMenu">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
      </button>
      <div class="topbar-profile" id="topbarUser">
        <div class="topbar-avatar"></div>
        <div class="topbar-user-info">
          <span class="user-name" id="userName">Usuario</span>
          <span class="user-role user-role-admin" id="userRole">Administrador</span>
        </div>
      </div>
      <div class="topbar-search">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="search" placeholder="Buscar aqu√≠..." aria-label="Buscar" id="searchInput">
      </div>
      <div class="topbar-actions">
        <h1 class="topbar-title" id="topbarTitle">Inicio</h1>
        <button type="button" class="topbar-download" id="btnDescargarInforme" title="Descargar informe" aria-label="Descargar informe">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          <span>Descargar</span>
        </button>
        <button type="button" class="btn-logout" id="btnCerrarSesion" title="Cerrar sesi√≥n" aria-label="Cerrar sesi√≥n">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
          <span>Cerrar sesi√≥n</span>
        </button>
      </div>
    </header>

    <main class="content">
      <section id="section-dashboard" class="section active">
        <div class="dashboard-admin-content" id="dashboardAdminContent">
        <div id="dashboardAdminBlocks">
        <!-- Gesti√≥n Operaci√≥n - QoE -->
        <div class="calidad-header-bar" id="gestionOperacionHfcHeaderBar">
          <h2 class="section-subtitle">GESTI√ìN OPERACI√ìN - QoE</h2>
          <button type="button" class="calidad-toggle-btn" id="toggleGestionOperacionHfc" aria-label="Minimizar o expandir Gesti√≥n Operaci√≥n - QoE" title="Minimizar/Expandir">
            <svg class="icon-expand" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
            <svg class="icon-collapse" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/></svg>
          </button>
        </div>
        <div id="gestionOperacionHfcContent">
        <div class="calidad-block">
          <h3 class="eyn-titulo">Cierres y Visitas t√©cnicas</h3>
          <div class="eyn-cajitas" id="eynCajitasHfc">
            <article class="card eyn-caja">
              <h3>Casos Solucionados</h3>
              <div class="eyn-caja-body" id="hfcCierresContacto"></div>
            </article>
            <article class="card eyn-caja">
              <h3>Afectaciones masivas</h3>
              <div class="eyn-caja-body" id="hfcCierresBuzon"></div>
            </article>
            <article class="card eyn-caja">
              <h3>Visitas t√©cnicas</h3>
              <div class="eyn-caja-body" id="hfcReincidencias"></div>
            </article>
          </div>
          <div class="dashboard-bottom" style="margin-top:1.5rem">
            <div class="card hfc-comparativo-card" style="width:100%">
              <h3>Comparativo: Casos Solucionados vs Afectaciones masivas vs Visitas t√©cnicas</h3>
              <div class="hfc-comparativo-chart" id="hfcComparativoChart">
                <div class="hfc-comparativo-row">
                  <span class="hfc-comparativo-label">Casos Solucionados</span>
                  <div class="hfc-comparativo-track"><div class="hfc-comparativo-fill hfc-fill-contacto" id="hfcBarContacto" style="width:0%"></div></div>
                  <span class="hfc-comparativo-val" id="hfcValContacto">0</span>
                  <span class="hfc-comparativo-pct" id="hfcPctContacto">0%</span>
                </div>
                <div class="hfc-comparativo-row">
                  <span class="hfc-comparativo-label">Afectaciones masivas</span>
                  <div class="hfc-comparativo-track"><div class="hfc-comparativo-fill hfc-fill-buzon" id="hfcBarBuzon" style="width:0%"></div></div>
                  <span class="hfc-comparativo-val" id="hfcValBuzon">0</span>
                  <span class="hfc-comparativo-pct" id="hfcPctBuzon">0%</span>
                </div>
                <div class="hfc-comparativo-row">
                  <span class="hfc-comparativo-label">Visitas t√©cnicas</span>
                  <div class="hfc-comparativo-track"><div class="hfc-comparativo-fill hfc-fill-reinc" id="hfcBarReinc" style="width:0%"></div></div>
                  <span class="hfc-comparativo-val" id="hfcValReinc">0</span>
                  <span class="hfc-comparativo-pct" id="hfcPctReinc">0%</span>
                </div>
              </div>
            </div>
            <div class="card hfc-donuts-panel" style="width:100%">
              <div class="donuts-row hfc-donuts-row" id="hfcDonutsWrap">
                <div class="donut-mini">
                  <div class="donut-ring hfc-donut" style="--pct:36;--c:var(--integra-cyan)" id="hfcDonut1"></div>
                  <span class="donut-label" id="hfcDonut1Label">36%</span>
                </div>
                <div class="donut-mini">
                  <div class="donut-ring hfc-donut" style="--pct:64;--c:var(--integra-rose)" id="hfcDonut2"></div>
                  <span class="donut-label" id="hfcDonut2Label">64%</span>
                </div>
                <div class="donut-mini">
                  <div class="donut-ring hfc-donut" style="--pct:0;--c:var(--integra-violet)" id="hfcDonut3"></div>
                  <span class="donut-label" id="hfcDonut3Label">0%</span>
                </div>
              </div>
            </div>
          </div>
        </div>
        </div>

        <hr class="section-divider" aria-hidden="true">

        <!-- Gesti√≥n Operaci√≥n - FO -->
        <div class="calidad-header-bar" id="gestionOperacionHeaderBar">
          <h2 class="section-subtitle">Gesti√≥n Operaci√≥n - FO</h2>
          <button type="button" class="calidad-toggle-btn" id="toggleGestionOperacion" aria-label="Minimizar o expandir Gesti√≥n Operaci√≥n - FO" title="Minimizar/Expandir">
            <svg class="icon-expand" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
            <svg class="icon-collapse" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/></svg>
          </button>
        </div>
        <div id="gestionOperacionContent">
        <div class="calidad-block">
          <h3 class="eyn-titulo">Casos Abiertos</h3>
          <div class="eyn-cajitas" id="eynCajitas">
            <article class="card eyn-caja">
              <h3>Casos Solucionados</h3>
              <div class="eyn-caja-body" id="eynBackNegocios"></div>
            </article>
            <article class="card eyn-caja">
              <h3>Casos no solucionados</h3>
              <div class="eyn-caja-body" id="eynNegociosGI"></div>
            </article>
            <article class="card eyn-caja">
              <h3>EYN- PROACTIVIDAD VIP</h3>
              <div class="eyn-caja-body" id="eynProactividad"></div>
            </article>
          </div>
          <p class="calidad-section-sub">SLA y rankings de agentes</p>
          <div class="calidad-grid">
            <article class="card">
              <h3>SLA - Fase de cierre (50%/75%)</h3>
              <div class="sla-fase-cierre-list" id="slaFaseCierreList"></div>
            </article>
            <article class="card">
              <h3>Estado Resuelto</h3>
              <div class="ranking-list" id="rankingMasCierran"></div>
            </article>
            <article class="card">
              <h3>Rastreo de casos no solucionados (revalidados)</h3>
              <p class="calidad-section-sub">SDs tocados por 2+ agentes sin soluci√≥n</p>
              <div class="table-wrap">
                <table class="data-table portal-table" id="tablaRastreoSd">
                  <thead><tr><th>SD</th><th>Agentes</th><th>Validaciones</th><th>√öltima fecha</th></tr></thead>
                  <tbody id="rastreoSdBody"></tbody>
                </table>
              </div>
              <p class="portal-empty" id="rastreoSdEmpty">No hay casos revalidados sin soluci√≥n.</p>
            </article>
          </div>
        </div>
        <div class="dashboard-bottom">
          <div class="panel-reincidencia-chart">
            <div class="panel-reincidencia-header">
              <h3>TOP 10 C√ìDIGOS DE SERVICIO M√ÅS REINCIDENTES</h3>
              <svg class="icon-trofeo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M8 21h8"/><path d="M12 17v4"/><path d="M7 4h10v7a5 5 0 0 1-10 0V4z"/><path d="M7 4a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v3h4V4z"/><path d="M17 4a2 2 0 0 1 2-2h1a2 2 0 0 1 2 2v3h-4V4z"/><path d="M5 7H3v2a5 5 0 0 0 4 4.9V7z"/><path d="M21 7h-2v2a5 5 0 0 1-4 4.9V7z"/></svg>
            </div>
            <div class="reincidencia-chart-wrap" id="reincidenciaChartWrap">
              <div class="reincidencia-bars" id="reincidenciaBars"></div>
            </div>
          </div>
          <div class="panel-reincidencia-chart panel-reincidencia-sin-enlace">
            <div class="panel-reincidencia-header">
              <h3>TOP 10 CI/AFECTADO SIN ENLACE (NITs)</h3>
              <svg class="icon-trofeo" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
            </div>
            <div class="reincidencia-chart-wrap" id="reincidenciaSinEnlaceChartWrap">
              <div class="reincidencia-bars" id="reincidenciaBarsSinEnlace"></div>
            </div>
          </div>
        </div>
        </div>

        <hr class="section-divider" aria-hidden="true">

        <!-- Calidad -->
        <div class="calidad-header-bar" id="calidadHeaderBar">
          <h2 class="section-subtitle">Matriz de Calidad</h2>
          <button type="button" class="calidad-toggle-btn" id="toggleCalidad" aria-label="Minimizar o expandir Matriz de Calidad" title="Minimizar/Expandir">
            <svg class="icon-expand" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
            <svg class="icon-collapse" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/></svg>
          </button>
        </div>
        <div id="calidadDashboardContent">
        <div class="calidad-block calidad-block-orden">
          <div class="calidad-grid">
            <article class="card card-semaforo" id="calidadSemaforoCard">
              <h3>Estado general de calidad</h3>
              <div class="semaforo-wrap" id="calidadSemaforoWrap"></div>
            </article>
            <article class="card">
              <h3>√Årea con mayor impacto en calidad</h3>
              <div class="letra-mas-afectada-wrap" id="letraMasAfectadaWrap"></div>
            </article>
            <article class="card">
              <h3>Procesos con mayor incidencia de error</h3>
              <div class="top3-macro-wrap" id="top3MacroWrap"></div>
            </article>
            <article class="card card-insight" id="calidadInsightCard">
              <h3>üí° Insight de calidad</h3>
              <div class="insight-wrap" id="calidadInsightWrap"></div>
            </article>
          </div>
          <div class="calidad-tendencia" id="calidadTendenciaWrap"></div>
        </div>
        </div>

        </div>
        <div id="dashboardAgentContent" class="dashboard-agent-content" style="display:none" data-user-only>
          <div id="productividadAgenteWrap"></div>
        </div>

        <hr class="section-divider" id="formacionDashboardHr" aria-hidden="true">

        <!-- Formaci√≥n -->
        <div class="formacion-header-bar" id="formacionHeaderBar">
          <h2 class="section-subtitle">Formaci√≥n</h2>
          <button type="button" class="formacion-toggle-btn" id="toggleFormacion" aria-label="Minimizar o expandir Formaci√≥n" title="Minimizar/Expandir">
            <svg class="icon-expand" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
            <svg class="icon-collapse" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 12h14"/></svg>
          </button>
        </div>
        <div id="formacionDashboardContent">
        <!-- Fila 1: Nota certificaci√≥n | Certificaci√≥n Mensual | Cobertura -->
        <div class="dashboard-row1">
          <div class="kpi-group kpi-group-teal">
            <h3 class="kpi-group-title">Nota de certificaci√≥n</h3>
            <div class="kpi-row">
              <div class="kpi-box">
                <span class="kpi-val" id="kpiCertAprobados">25</span>
                <span class="kpi-label">Aprobados</span>
              </div>
              <div class="kpi-box">
                <span class="kpi-val" id="kpiCertReprobados">3</span>
                <span class="kpi-label">Reprobados</span>
              </div>
              <div class="kpi-box">
                <span class="kpi-val" id="kpiCertCobertura">65 %</span>
                <span class="kpi-label">Cobertura</span>
              </div>
            </div>
            <div class="sparkline-wrap" id="sparkCert">
              <svg class="sparkline" viewBox="0 0 200 50" preserveAspectRatio="none">
                <line class="sparkline-reference" x1="0" y1="25" x2="200" y2="25" stroke="#f472b6" stroke-width="1" stroke-dasharray="4 2" stroke-opacity="0.9"/>
                <polyline fill="none" stroke="var(--integra-cyan)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
          </div>
          <div class="panel-aprobacion panel-aprobacion-futuro">
            <h3>Certificaci√≥n Mensual</h3>
            <div class="aprobacion-futuro-grid">
              <div class="aprobacion-col-izq">
                <div class="aprobacion-tasa-num" id="aprobacionTasaNum">80.6%</div>
                <div class="aprobacion-tasa-label">Tasa de Aprobaci√≥n</div>
                <ul class="aprobacion-lista">
                  <li><span class="aprobacion-icon aprobacion-icon-rose"></span><span id="leyendaReprobo">Reprob√≥ 2</span></li>
                  <li><span class="aprobacion-icon aprobacion-icon-orange"></span><span id="leyendaNovedades">Novedades 4</span></li>
                  <li><span class="aprobacion-icon aprobacion-icon-total"></span><span id="leyendaTotalEval">Total evaluados 31</span></li>
                </ul>
              </div>
              <div class="aprobacion-col-der">
                <div class="pie-aprobacion-wrap-futuro">
                  <div class="pie-aprobacion pie-aprobacion-futuro" id="pieAprobacion" role="img" aria-label="Certificaci√≥n mensual"></div>
                  <div class="pie-aprobacion-center">
                    <span class="pie-aprobacion-val" id="pieAprobacionVal">80.6%</span>
                    <span class="pie-aprobacion-label">Tasa de Aprobaci√≥n</span>
                  </div>
                </div>
              </div>
            </div>
            <div class="aprobacion-footer">
              <span class="leyenda-item"><i class="leyenda-dot" style="background:var(--integra-rose)"></i> <span id="leyendaReproboFooter">Reprob√≥ 2</span></span>
              <span class="leyenda-item"><i class="leyenda-dot" style="background:var(--integra-orange)"></i> <span id="leyendaNovedadesFooter">Novedades 4</span></span>
              <span class="leyenda-item"><i class="leyenda-dot" style="background:var(--integra-text-muted)"></i> <span id="leyendaTotalFooter">Total evaluados 31</span></span>
            </div>
          </div>
        </div>

        <!-- Fila 2: Estatus del preturno + Promedio -->
        <div class="dashboard-row2">
          <div class="kpi-group">
            <h3 class="kpi-group-title">Estatus del preturno</h3>
            <div class="sparkline-wrap sparkline-pret" id="sparkPret">
              <svg class="sparkline" viewBox="0 0 200 50" preserveAspectRatio="none">
                <polyline class="sparkline-agentes" fill="none" stroke="var(--integra-success)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                <polyline class="sparkline-staff" fill="none" stroke="#f472b6" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            <div class="desempeno-leyenda">
              <span class="desempeno-leyenda-item"><i class="desempeno-dot" style="background:var(--integra-success)"></i> Preturnos Agentes</span>
              <span class="desempeno-leyenda-item"><i class="desempeno-dot" style="background:var(--integra-rose)"></i> Preturnos Staff</span>
            </div>
            <div class="desempeno-chart">
              <div class="desempeno-bar-wrap">
                <span class="desempeno-label">Preturnos Agentes</span>
                <div class="desempeno-bar-bg"><div class="desempeno-bar" id="desempenoBarAgentes" style="--pct:99"></div></div>
                <span class="desempeno-val" id="desempenoValAgentes">99.4</span>
              </div>
              <div class="desempeno-bar-wrap">
                <span class="desempeno-label">Preturnos Staff</span>
                <div class="desempeno-bar-bg"><div class="desempeno-bar desempeno-bar-staff" id="desempenoBarStaff" style="--pct:89"></div></div>
                <span class="desempeno-val" id="desempenoValStaff">89 %</span>
              </div>
            </div>
          </div>
          <div class="panel-promedio">
            <h3>Preturnos Agentes</h3>
            <div class="gauge-wrap">
              <svg class="gauge-svg gauge-segmented" viewBox="0 0 200 130" aria-label="Preturnos Agentes">
                <g class="gauge-segments">
                  <path class="gauge-seg gauge-seg-red" d="M 25 95 A 75 75 0 0 1 29.5 69.4"/>
                  <path class="gauge-seg gauge-seg-red" d="M 29.5 69.4 A 75 75 0 0 1 42.5 46.8"/>
                  <path class="gauge-seg gauge-seg-red" d="M 42.5 46.8 A 75 75 0 0 1 62.5 30"/>
                  <path class="gauge-seg gauge-seg-yellow" d="M 62.5 30 A 75 75 0 0 1 87 21"/>
                  <path class="gauge-seg gauge-seg-yellow" d="M 87 21 A 75 75 0 0 1 113 21"/>
                  <path class="gauge-seg gauge-seg-green" d="M 113 21 A 75 75 0 0 1 137.5 30"/>
                  <path class="gauge-seg gauge-seg-green" d="M 137.5 30 A 75 75 0 0 1 157.5 46.8"/>
                  <path class="gauge-seg gauge-seg-green" d="M 157.5 46.8 A 75 75 0 0 1 170.5 69.4"/>
                  <path class="gauge-seg gauge-seg-green" d="M 170.5 69.4 A 75 75 0 0 1 175 95"/>
                </g>
                <g class="gauge-labels">
                  <text x="22" y="78">10%</text><text x="35" y="55">20%</text><text x="50" y="38">30%</text>
                  <text x="72" y="26">40%</text><text x="100" y="18">50%</text><text x="128" y="26">60%</text>
                  <text x="150" y="38">70%</text><text x="165" y="55">80%</text><text x="178" y="78">90%</text>
                </g>
                <path class="gauge-base" d="M 85 95 A 15 15 0 0 1 115 95" fill="var(--integra-border)"/>
                <line class="gauge-needle" id="promedioNeedleDash" x1="100" y1="95" x2="100" y2="35" stroke="var(--integra-text)" stroke-width="3" stroke-linecap="round"/>
              </svg>
              <span class="gauge-valor" id="promedioValorDash">99.4</span>
              <span class="gauge-mes" id="promedioMesDash"></span>
            </div>
          </div>
          <div class="panel-promedio panel-promedio-staff">
            <h3>Preturnos Staff</h3>
            <div class="gauge-wrap">
              <svg class="gauge-svg gauge-segmented" viewBox="0 0 200 130" aria-label="Preturnos Staff">
                <g class="gauge-segments">
                  <path class="gauge-seg gauge-seg-red" d="M 25 95 A 75 75 0 0 1 29.5 69.4"/>
                  <path class="gauge-seg gauge-seg-red" d="M 29.5 69.4 A 75 75 0 0 1 42.5 46.8"/>
                  <path class="gauge-seg gauge-seg-red" d="M 42.5 46.8 A 75 75 0 0 1 62.5 30"/>
                  <path class="gauge-seg gauge-seg-yellow" d="M 62.5 30 A 75 75 0 0 1 87 21"/>
                  <path class="gauge-seg gauge-seg-yellow" d="M 87 21 A 75 75 0 0 1 113 21"/>
                  <path class="gauge-seg gauge-seg-green" d="M 113 21 A 75 75 0 0 1 137.5 30"/>
                  <path class="gauge-seg gauge-seg-green" d="M 137.5 30 A 75 75 0 0 1 157.5 46.8"/>
                  <path class="gauge-seg gauge-seg-green" d="M 157.5 46.8 A 75 75 0 0 1 170.5 69.4"/>
                  <path class="gauge-seg gauge-seg-green" d="M 170.5 69.4 A 75 75 0 0 1 175 95"/>
                </g>
                <g class="gauge-labels">
                  <text x="22" y="78">10%</text><text x="35" y="55">20%</text><text x="50" y="38">30%</text>
                  <text x="72" y="26">40%</text><text x="100" y="18">50%</text><text x="128" y="26">60%</text>
                  <text x="150" y="38">70%</text><text x="165" y="55">80%</text><text x="178" y="78">90%</text>
                </g>
                <path class="gauge-base" d="M 85 95 A 15 15 0 0 1 115 95" fill="var(--integra-border)"/>
                <line class="gauge-needle" id="promedioStaffNeedleDash" x1="100" y1="95" x2="100" y2="35" stroke="var(--integra-text)" stroke-width="3" stroke-linecap="round"/>
              </svg>
              <span class="gauge-valor" id="promedioStaffValorDash">89 %</span>
              <span class="gauge-mes" id="promedioStaffMesDash"></span>
            </div>
          </div>
        </div>
        </div>
        </div>
      </section>

      <section id="section-intermitencia" class="section">
        <div class="intermitencia-header">
          <h2>Intermitencia</h2>
          <p>Clientes revisados en diagn√≥stico DOCSIS</p>
        </div>
        <div class="intermitencia-counter-card">
          <span class="intermitencia-counter-icon">‚úì</span>
          <span class="intermitencia-counter-val" id="intermitenciaCountVal">0</span>
          <span class="intermitencia-counter-label">Casos validados</span>
        </div>
        <div class="portal-card intermitencia-card">
          <div class="intermitencia-list-wrap" id="intermitenciaListWrap">
            <p class="intermitencia-empty" id="intermitenciaEmpty">No hay clientes registrados. Guarda registros desde Inicio.</p>
            <table class="intermitencia-tabla" id="intermitenciaTabla" style="display:none">
              <thead>
                <tr><th>N√∫mero de cuenta</th><th>N¬∫ PQR</th><th>Marcaci√≥n</th><th>¬øHubo Soluci√≥n?</th><th>¬øAgendo visita?</th><th>Llamada de servicio</th><th>¬øMaiva?</th><th>INC</th><th>Fecha</th></tr>
              </thead>
              <tbody id="intermitenciaTbody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <section id="section-gestion" class="section">
        <div class="agentes-header">
          <h2>Mi Gesti√≥n</h2>
          <p>Documenta tus casos y lleva el conteo de cu√°ntos has tocado</p>
        </div>
        <div class="gestion-counter-card">
          <span class="gestion-counter-icon gestion-counter-icon-red">üìÑ</span>
          <span class="gestion-counter-val" id="gestionCasosCount">0</span>
          <span class="gestion-counter-label">Casos que has tocado</span>
          <button type="button" class="gestion-counter-download" id="btnGestionDescargarExcel" title="Descargar Excel" aria-label="Descargar Excel">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><path d="M9 15l3 3 3-3"/></svg>
          </button>
        </div>
        <div class="portal-card gestion-form-card">
          <h3 class="portal-card-title">Gesti√≥n Inmediata</h3>
          <div class="gestion-form">
            <div class="gestion-section">
              <h4>Datos del caso</h4>
              <div class="gestion-row">
                <div class="portal-field"><label for="gestionNombre">Nombre del T√©cnico</label><input type="text" id="gestionNombre" placeholder="Nombre del t√©cnico"></div>
                <div class="portal-field"><label for="gestionNumero">N√∫mero</label><input type="text" id="gestionNumero" placeholder="N√∫mero"></div>
                <div class="portal-field"><label for="gestionNit">Digite Enlace <span class="gestion-required">*</span></label><input type="text" id="gestionNit" placeholder="Enlace" required></div>
              </div>
            </div>
            <div class="gestion-section">
              <h4>√Årea y funci√≥n</h4>
              <div class="gestion-row">
                <div class="portal-field"><label for="gestionAliado">Aliado</label><select id="gestionAliado" aria-label="Seleccione aliado">
                  <option value="">Seleccione aliado</option>
                  <option value="DICO">DICO</option>
                  <option value="TABASCO">TABASCO</option>
                  <option value="ALGAR">ALGAR</option>
                  <option value="INMEL">INMEL</option>
                  <option value="CINCO">CINCO</option>
                  <option value="TELCOS">TELCOS</option>
                  <option value="DOMINIUM">DOMINIUM</option>
                  <option value="SICTE">SICTE</option>
                  <option value="CONECTAR">CONECTAR</option>
                  <option value="POSITIVO">POSITIVO</option>
                </select></div>
                <div class="portal-field"><label for="gestionFuncion">Funci√≥n</label><select id="gestionFuncion" aria-label="Seleccione funci√≥n">
                  <option value="">Seleccione</option>
                  <option value="DATOS">DATOS</option>
                  <option value="PLANTA">PLANTA</option>
                </select></div>
                <div class="portal-field"><label for="gestionImot">IM/OT</label><input type="text" id="gestionImot" placeholder="IM/OT"></div>
              </div>
            </div>
            <div class="gestion-section">
              <h4>Transferencia y cliente</h4>
              <div class="gestion-row">
                <div class="portal-field"><label for="gestionTransferencia">Transferencia</label><select id="gestionTransferencia" aria-label="Seleccione transferencia">
                  <option value="">Seleccione</option>
                  <option value="SI">SI</option>
                  <option value="NO">NO</option>
                </select></div>
                <div class="portal-field"><label for="gestionCliente">Cliente recibe servicio</label><input type="text" id="gestionCliente" placeholder="Nombre del cliente"></div>
                <div class="portal-field"><label for="gestionPqr">SD / PQR (ej. SD12345)</label><input type="text" id="gestionPqr" placeholder="SD12345" title="Ingrese el n√∫mero SD para rastreo de revalidaciones"></div>
              </div>
              <div class="gestion-row gestion-transferencia-extras" id="gestionTransferenciaExtras" style="display:none">
                <div class="portal-field"><label for="gestionAreaTransferir">√Årea a transferir</label><select id="gestionAreaTransferir" aria-label="Seleccione √°rea">
                  <option value="">Seleccione √°rea</option>
                  <option value="Empresas GI" data-ext="41491000000">Empresas GI</option>
                  <option value="Clientes especiales remotos/Front" data-ext="41492000000">Clientes especiales remotos/Front</option>
                  <option value="NOC Clientes especiales" data-ext="41453200000">NOC Clientes especiales</option>
                  <option value="NOC LAN" data-ext="41491600000">NOC LAN</option>
                  <option value="NOC Negocios/IRE Negocios" data-ext="41490800000">NOC Negocios/IRE Negocios</option>
                  <option value="EYN - NOC Corporativo ‚Äì P1" data-ext="41491500000">EYN - NOC Corporativo ‚Äì P1</option>
                  <option value="LAN ADMINISTRADA" data-ext="93105634345">LAN ADMINISTRADA</option>
                  <option value="Datacenter - Red Corporativa" data-ext="41776200000">Datacenter - Red Corporativa</option>
                </select></div>
                <div class="portal-field"><label for="gestionExtensiones">Extensiones</label><input type="text" id="gestionExtensiones" placeholder="Se selecciona con el √°rea" readonly></div>
              </div>
            </div>
            <div class="gestion-section">
              <h4>Detalle de la falla</h4>
              <div class="gestion-row">
                <div class="portal-field"><label for="gestionCausa">Causa de la falla</label><textarea id="gestionCausa" rows="2" placeholder="Describa la causa de la falla"></textarea></div>
                <div class="portal-field"><label for="gestionSolucion">Soluci√≥n de la falla</label><textarea id="gestionSolucion" rows="2" placeholder="Describa la soluci√≥n aplicada"></textarea></div>
              </div>
            </div>
            <div class="gestion-section" id="gestionPruebasSection">
              <h4>Pruebas de configuraciones</h4>
              <div class="gestion-grid-config">
                <div class="portal-field"><label for="gestionRed">Red de acceso</label><input type="text" id="gestionRed" placeholder="Ej. Ok"></div>
                <div class="portal-field"><label for="gestionNodo">Nodo</label><input type="text" id="gestionNodo" placeholder="Ej. Ok"></div>
                <div class="portal-field"><label for="gestionCpe">Acceso a CPE</label><input type="text" id="gestionCpe" placeholder="Ej. Ok"></div>
              </div>
              <div class="portal-field gestion-hubo-solucion-wrap" id="gestionHuboSolucionWrap" style="display:none; margin-top:0.75rem">
                <label for="gestionHuboSolucion">¬øHubo soluci√≥n?</label>
                <select id="gestionHuboSolucion">
                  <option value="">‚Äî</option>
                  <option value="S√≠">S√≠</option>
                  <option value="Reagendado">Reagendado</option>
                </select>
              </div>
            </div>
            <button type="button" class="portal-btn portal-btn-primary" id="btnGestionAgregar">Agregar caso</button>
          </div>
        </div>
        <div class="portal-card gestion-plantilla-card">
          <div class="gestion-plantilla-header">
            <h3 class="portal-card-title">Plantilla de gesti√≥n (concatenada)</h3>
            <button type="button" class="portal-btn portal-btn-secondary" id="btnGestionCopiar">Copiar plantilla</button>
          </div>
          <p class="gestion-plantilla-desc">Se rellena con el nombre del agente y los datos del formulario o del caso seleccionado.</p>
          <textarea id="gestionPlantilla" class="gestion-plantilla-output" rows="12" readonly></textarea>
        </div>
        <div class="portal-card">
          <h3 class="portal-card-title">Mis casos</h3>
          <div class="table-wrap">
            <table class="data-table portal-table" id="tablaGestionCasos">
              <thead><tr><th>Nombre t√©cnico</th><th>N√∫mero</th><th>SD</th><th>Enlace</th><th>Aliado</th><th>Funci√≥n</th><th>Transferencia</th><th>√Årea</th><th>Extensiones</th><th>Cliente</th><th>Fecha/Hora</th><th>Duraci√≥n</th><th>Soluci√≥n</th><th>Acciones</th></tr></thead>
              <tbody id="gestionCasosBody"></tbody>
            </table>
          </div>
          <p class="portal-empty" id="gestionCasosEmpty">No has documentado casos a√∫n. Agrega uno arriba.</p>
        </div>
      </section>

      <section id="section-tablero-mensual" class="section">
        <div class="agentes-header">
          <h2>Tablero Mensual</h2>
          <p>Gesti√≥n d√≠a a d√≠a del mes. Visualiza en qu√© d√≠as gestionaste m√°s casos.</p>
        </div>
        <div class="tablero-download-card gestion-counter-card">
          <span class="gestion-counter-icon gestion-counter-icon-green">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="22" height="22"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><path d="M12 18v-6"/><path d="M9 15l3 3 3-3"/></svg>
          </span>
          <span class="gestion-counter-val" id="tableroDownloadCardCount">0</span>
          <span class="gestion-counter-label">Casos del mes ¬∑ Descargar Excel</span>
          <button type="button" class="gestion-counter-download" id="btnTableroDescargarExcel" title="Descargar casos del mes en Excel (CSV)" aria-label="Descargar Excel">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          </button>
        </div>
        <div class="tablero-mensual-card">
          <div class="tablero-mensual-header">
            <h3 class="portal-card-title" id="tableroMensualMes">Febrero 2025</h3>
            <select id="tableroMensualSelector" aria-label="Mes y a√±o">
              <!-- Se rellena por JS -->
            </select>
          </div>
          <div class="tablero-mensual-bars" id="tableroMensualBars">
            <!-- Barras d√≠a a d√≠a -->
          </div>
          <div class="tablero-mensual-totales">
            <div class="tablero-mensual-total">
              <span class="tablero-mensual-total-label">Gesti√≥n:</span>
              <span class="tablero-mensual-total-val" id="tableroMensualTotal">0</span>
              <span class="tablero-mensual-total-sub">casos</span>
            </div>
            <div class="tablero-mensual-total">
              <span class="tablero-mensual-total-label">Intermitencia:</span>
              <span class="tablero-mensual-total-val" id="tableroMensualIntermitencia">0</span>
              <span class="tablero-mensual-total-sub">validados</span>
            </div>
          </div>
          <p class="portal-empty" id="tableroMensualEmpty">No hay casos registrados en este mes.</p>
        </div>
      </section>

      <section id="section-calidad" class="section">
        <div class="calidad-header">
          <h2>Matriz de Calidad</h2>
          <p>Auditor√≠as de los agentes e √≠tems afectados</p>
        </div>
        <div class="auditorias-card">
          <h3>Auditor√≠as de los agentes</h3>
          <div class="auditorias-form-wrap">
            <div class="auditorias-form auditorias-form-cascada">
              <div class="auditoria-agente-wrap auditoria-agente-autocomplete">
                <input type="text" id="auditoriaAgente" placeholder="Escriba o seleccione agente" aria-label="Agente" autocomplete="off">
                <div class="auditoria-agente-dropdown" id="auditoriaAgenteDropdown" role="listbox"></div>
                <span class="auditoria-nota-actual" id="auditoriaNotaActual" title="Nota de calidad actual">Nota actual: ‚Äî</span>
              </div>
              <input type="text" id="auditoriaNota" placeholder="Nota (ej: 8.5)" aria-label="Nota" inputmode="decimal">
              <select id="auditoriaLetra" aria-label="Letra">
                <option value="">Seleccione letra</option>
                <option value="G">G</option>
                <option value="A1">A1</option>
                <option value="N">N</option>
                <option value="A2">A2</option>
              </select>
              <select id="auditoriaItem" aria-label="Item">
                <option value="">Seleccione item</option>
              </select>
              <select id="auditoriaItemCausales" aria-label="Item causales" style="display:none">
                <option value="">Seleccione item causal</option>
              </select>
              <button type="button" class="btn-auditoria-add" id="btnAuditoriaAgregar">Agregar</button>
            </div>
          </div>
          <div class="table-wrap">
            <table class="data-table auditorias-table" id="tablaAuditorias">
              <thead><tr><th>Agente</th><th>Nota</th><th>Letra</th><th>Macroproceso</th><th>Descripci√≥n del √≠tem</th><th></th></tr></thead>
              <tbody id="auditoriasBody"></tbody>
            </table>
          </div>
          <p class="auditorias-empty" id="auditoriasEmpty">No hay auditor√≠as. Agrega una arriba.</p>
        </div>
      </section>

      <section id="section-bolsa" class="section">
        <div class="calidad-header">
          <h2>Bolsa</h2>
          <p>Gesti√≥n de bolsa de horas</p>
        </div>
        <div class="portal-card">
          <h3 class="portal-card-title">Casos abiertos</h3>
<p class="portal-card-desc">Pega la tabla con columnas: ID de incidente, Prioridad, Estado de alerta, Estado, Grupo de asignaci√≥n. Estado de alerta (open‚Üíabiertos, 50%/75%‚ÜíSLA, 100%‚Üíresueltos).</p>
            <div class="bolsa-import">
            <label for="bolsaPegar">Pegar datos de Excel</label>
            <textarea id="bolsaPegar" rows="4" placeholder="Pega aqu√≠ la tabla (ID de incidente, Prioridad, Estado de alerta, Estado, Grupo de asignaci√≥n)"></textarea>
            <button type="button" class="portal-btn portal-btn-secondary" id="btnBolsaImportar">Importar y contar</button>
          </div>
          <div class="bolsa-form">
            <div class="portal-field">
              <label for="bolsaBackNegocios">Casos Solucionados</label>
              <span id="bolsaBackNegocios" class="bolsa-hfc-gestion-readonly">0</span>
              <span class="portal-field-hint">(¬øHubo soluci√≥n? = S√≠ en Mi Gesti√≥n, agentes Fibra √ìptica)</span>
            </div>
            <div class="portal-field">
              <label for="bolsaNegociosGI">Casos no solucionados</label>
              <input type="number" id="bolsaNegociosGI" min="0" placeholder="0" aria-label="Casos no solucionados">
            </div>
            <div class="portal-field">
              <label for="bolsaProactividad">EYN- PROACTIVIDAD VIP</label>
              <input type="number" id="bolsaProactividad" min="0" placeholder="0" aria-label="Casos Proactividad VIP">
            </div>
          </div>
          <p class="portal-card-desc">SLA fase de cierre (50%/75%) ‚Äì se extrae del Excel o se puede corregir manualmente:</p>
          <div class="bolsa-form bolsa-sla-fields">
            <div class="portal-field">
              <label for="bolsaSlaBackNegocios">SLA Back Negocios</label>
              <input type="number" id="bolsaSlaBackNegocios" min="0" placeholder="0" aria-label="SLA Back Negocios">
            </div>
            <div class="portal-field">
              <label for="bolsaSlaNegociosGI">SLA Negocios GI</label>
              <input type="number" id="bolsaSlaNegociosGI" min="0" placeholder="0" aria-label="SLA Negocios GI">
            </div>
            <div class="portal-field">
              <label for="bolsaSlaProactividad">SLA PROACTIVIDAD VIP</label>
              <input type="number" id="bolsaSlaProactividad" min="0" placeholder="0" aria-label="SLA Proactividad VIP">
            </div>
          </div>
          <button type="button" class="portal-btn" id="btnBolsaGuardar">Guardar</button>
        </div>
        <div class="portal-card">
          <h3 class="portal-card-title">Reincidencia 3 meses</h3>
          <p class="portal-card-desc">Pega la tabla de Excel. Se cuentan NITs con 2+ casos en los √∫ltimos 3 meses. Columnas esperadas: NIT, Fecha, CI/AFECTADO (c√≥digo de enlace). Los NITs se agrupan por c√≥digo CI/AFECTADO.</p>
          <div class="bolsa-import">
            <label for="reincidenciaPegar">Pegar datos de Excel</label>
            <textarea id="reincidenciaPegar" rows="4" placeholder="Pega aqu√≠ la tabla (columnas: NIT, Fecha, CI/AFECTADO, ID, Categor√≠a, etc.)"></textarea>
            <button type="button" class="portal-btn portal-btn-secondary" id="btnReincidenciaImportar">Importar y contar</button>
          </div>
          <div class="reincidencia-result-wrap">
            <div class="reincidencia-total">Total reincidencias: <span id="reincidenciaTotalVal">0</span></div>
            <div class="reincidencia-table-wrap">
              <table class="data-table portal-table" id="tablaReincidenciaBolsa">
                <thead><tr><th>CI/AFECTADO</th><th>NIT</th><th>Reincidencia</th></tr></thead>
                <tbody id="reincidenciaBodyBolsa"></tbody>
              </table>
            </div>
            <p class="portal-empty" id="reincidenciaEmptyBolsa">Importa datos arriba para ver NITs repetidos.</p>
          </div>
        </div>
        <div class="portal-card">
          <h3 class="portal-card-title">Asignar casos</h3>
          <p class="portal-card-desc">Pega la tabla con IMs. Se distribuyen al azar entre los agentes del portal.</p>
          <div class="bolsa-import">
            <label for="asignarCasosPegar">Pegar datos de Excel</label>
            <textarea id="asignarCasosPegar" rows="4" placeholder="Pega aqu√≠ la columna de IMs (ej. IM3788260, IM3788261...). Solo se extraen IDs con formato IM + d√≠gitos."></textarea>
            <button type="button" class="portal-btn portal-btn-secondary" id="btnAsignarCasosImportar">Importar y asignar</button>
          </div>
          <div class="asignar-casos-table-wrap">
            <table class="data-table portal-table" id="tablaAsignarCasos">
              <thead>
                <tr><th>Agente</th><th>Usuario</th><th>IMs asignados</th></tr>
              </thead>
              <tbody id="asignarCasosBody"></tbody>
            </table>
          </div>
          <p class="portal-empty" id="asignarCasosEmpty">Importa IMs arriba para ver la asignaci√≥n por agente.</p>
        </div>
      </section>

      <section id="section-bolsa-hfc" class="section">
        <div class="calidad-header">
          <h2>Bolsa HFC</h2>
          <p>Datos para Gesti√≥n Operaci√≥n - QoE</p>
        </div>
        <div class="portal-card">
          <h3 class="portal-card-title">Datos HFC</h3>
          <p class="portal-card-desc">Datos para la secci√≥n QoE en Inicio. Casos Solucionados = ¬øHubo soluci√≥n? S√≠ en Intermitencia. Visitas t√©cnicas: pega tabla con NIT y Fecha.</p>
          <div class="bolsa-form">
            <div class="portal-field">
              <label for="bolsaHfcCierresContacto">Casos Solucionados</label>
              <span id="bolsaHfcCierresContacto" class="bolsa-hfc-gestion-readonly">0</span>
              <span class="portal-field-hint">(¬øHubo soluci√≥n? = S√≠ en Intermitencia)</span>
            </div>
            <div class="portal-field">
              <label for="bolsaHfcCierresBuzon">Afectaciones masivas</label>
              <span id="bolsaHfcCierresBuzon" class="bolsa-hfc-gestion-readonly">0</span>
              <span class="portal-field-hint">(Declaraciones masivas de agentes en QoE)</span>
            </div>
          </div>
          <div class="bolsa-import">
            <label for="hfcReincidenciaPegar">Visitas t√©cnicas HFC</label>
            <textarea id="hfcReincidenciaPegar" rows="3" placeholder="Pega tabla (NIT, Fecha)"></textarea>
            <button type="button" class="portal-btn portal-btn-secondary" id="btnHfcReincidenciaImportar">Importar visitas t√©cnicas HFC</button>
          </div>
          <div class="bolsa-form" style="margin-top:1rem">
            <div class="portal-field">
              <label for="bolsaHfcReincidenciasNum">Visitas t√©cnicas</label>
              <span id="bolsaHfcReincidenciasNum" class="bolsa-hfc-gestion-readonly">0</span>
              <span class="portal-field-hint">(¬øAgendo visita? = S√≠ en Intermitencia)</span>
            </div>
          </div>
        </div>
      </section>

      <section id="section-formacion" class="section">
        <div class="formacion-header">
          <h2>Formaci√≥n</h2>
          <p>Planta, cobertura y resultados de formaci√≥n</p>
        </div>
        <div class="formacion-tables">
          <div class="formacion-table-card">
            <h3>Alcance</h3>
            <table class="formacion-table">
              <tr><th>Planta Total</th><td class="editable" contenteditable="true" data-key="plantaTotal" id="formPlantaTotal">35</td></tr>
              <tr><th>P√∫blico Objetivo</th><td class="editable" contenteditable="true" data-key="publicoObjetivo" id="formPublicoObjetivo">31</td></tr>
            </table>
          </div>
          <div class="formacion-table-card">
            <h3>Asistencia</h3>
            <table class="formacion-table">
              <tr><th>Present√≥</th><td class="editable" contenteditable="true" data-key="presento" id="formPresento">20</td><td id="formPresentoPct">65 %</td></tr>
              <tr><th>Pendiente</th><td class="editable" contenteditable="true" data-key="pendiente" id="formPendiente">11</td><td></td></tr>
              <tr><th>Cobertura</th><td colspan="2" id="formCobertura">65 %</td></tr>
            </table>
          </div>
          <div class="formacion-table-card">
            <h3>Resultados</h3>
            <table class="formacion-table">
              <tr><th>Aprob√≥ <span class="formacion-base-hint">(% s/ Present√≥)</span></th><td class="editable" contenteditable="true" data-key="aprobo" id="formaprobo">18</td><td id="formaproboPct">90 %</td></tr>
              <tr><th>Reprob√≥ <span class="formacion-base-hint">(% s/ Present√≥)</span></th><td class="editable" contenteditable="true" data-key="reprobo" id="formReprobo">2</td><td id="formReproboPct">10 %</td></tr>
              <tr><th>Novedades <span class="formacion-base-hint">(% s/ P√∫blico Objetivo)</span></th><td class="editable" contenteditable="true" data-key="novedades" id="formNovedades">4</td><td id="formNovedadesPct">13 %</td></tr>
            </table>
          </div>
        </div>
        <div class="formacion-cobertura-panel">
          <h3>Cobertura</h3>
          <div class="cobertura-ring-wrap">
            <div class="cobertura-ring" id="coberturaRing" style="--pct:65"></div>
            <span class="cobertura-valor" id="coberturaValor">65 %</span>
          </div>
        </div>
        <div class="formacion-staff-card">
          <h3>Estatus de Staff</h3>
          <div class="preturnos-table-wrap">
            <table class="preturnos-table" id="tablaStaff">
              <thead>
                <tr>
                  <th>Skill</th>
                  <th>Programados</th>
                  <th>Asistencia Virtual</th>
                  <th>Promedio</th>
                </tr>
              </thead>
              <tbody id="staffBody"></tbody>
              <tfoot>
                <tr class="preturnos-total">
                  <th>Total</th>
                  <td id="staffTotalProg" class="preturnos-total-prog">0</td>
                  <td id="staffTotalAsist" class="asist-mid">0 %</td>
                  <td id="staffTotalProm" class="preturnos-total-prom">0</td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
        <div class="formacion-preturnos-card">
          <h3>Preturnos</h3>
          <div class="preturnos-table-wrap">
            <table class="preturnos-table" id="tablaPreturnos">
              <thead>
                <tr>
                  <th>Skill</th>
                  <th>Programados</th>
                  <th>Asistencia Virtual</th>
                  <th>Promedio</th>
                </tr>
              </thead>
              <tbody id="preturnosBody"></tbody>
              <tfoot>
                <tr class="preturnos-total">
                  <th>Total</th>
                  <td id="preturnosTotalProg" class="preturnos-total-prog">0</td>
                  <td id="preturnosTotalAsist" class="asist-mid">0 %</td>
                  <td id="preturnosTotalProm" class="preturnos-total-prom">0</td>
                </tr>
              </tfoot>
            </table>
          </div>
        </div>
      </section>

      <section id="section-agentes" class="section">
        <div class="agentes-header">
          <h2>Usuarios del portal</h2>
          <p>Usuarios con clave temporal que deben cambiar contrase√±a al entrar</p>
        </div>

        <div class="portal-card">
          <h3 class="portal-card-title">Agregar un usuario</h3>
          <div class="portal-form-grid">
            <div class="portal-field">
              <label for="portalNombre">Nombre</label>
              <input type="text" id="portalNombre" placeholder="Ej. Mar√≠a Garc√≠a" autocomplete="name">
            </div>
            <div class="portal-field">
              <label for="portalUsuario">Usuario (login)</label>
              <input type="text" id="portalUsuario" placeholder="Ej. mgarcia" autocomplete="username">
            </div>
            <div class="portal-field portal-field-row">
              <label for="portalClave">Clave temporal</label>
              <div class="portal-input-group">
                <input type="text" id="portalClave" placeholder="Generar aleatoria" readonly>
                <button type="button" class="portal-btn portal-btn-secondary" id="btnGenerarClave">Generar</button>
              </div>
            </div>
          </div>
          <button type="button" class="portal-btn portal-btn-primary" id="btnAgregarUsuario">Agregar usuario</button>
        </div>

        <div class="portal-card">
          <h3 class="portal-card-title">Cargar por nombres</h3>
          <p class="portal-card-desc">Pega un nombre por l√≠nea. Se generar√° usuario y clave temporal para cada uno.</p>
          <textarea id="portalNombres" class="portal-textarea" rows="5" placeholder="Mar√≠a Garc√≠a&#10;Juan P√©rez&#10;Ana L√≥pez"></textarea>
          <button type="button" class="portal-btn portal-btn-cyan" id="btnGenerarUsuarios">Generar usuarios con clave temporal</button>
        </div>

        <div class="portal-card">
          <h3 class="portal-card-title">Listado de usuarios</h3>
          <div class="table-wrap">
            <table class="data-table portal-table" id="tablaUsuarios">
              <thead>
                <tr>
                  <th>Nombre</th>
                  <th>Usuario</th>
                  <th>Estado</th>
                  <th>Rol</th>
                  <th>Nota de Calidad</th>
                  <th>Clave temporal</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody id="usuariosBody"></tbody>
            </table>
          </div>
          <p class="portal-empty" id="portalEmpty">No hay usuarios. Agrega uno o carga por nombres.</p>
        </div>
      </section>

      <section id="section-perfil" class="section">
        <div class="agentes-header">
          <h2>Perfil</h2>
          <p>Administra tu cuenta y cambia tu contrase√±a</p>
        </div>
        <div class="portal-card">
          <h3 class="portal-card-title">Cambiar contrase√±a</h3>
          <form id="perfilFormCambiarClave" class="portal-form-grid perfil-form">
            <div class="portal-field">
              <label for="perfilClaveActual">Contrase√±a actual</label>
              <input type="password" id="perfilClaveActual" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
            </div>
            <div class="portal-field">
              <label for="perfilClaveNueva">Nueva contrase√±a</label>
              <input type="password" id="perfilClaveNueva" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
            </div>
            <div class="portal-field">
              <label for="perfilClaveConfirmar">Confirmar nueva contrase√±a</label>
              <input type="password" id="perfilClaveConfirmar" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="new-password">
            </div>
            <div class="portal-field portal-field-row">
              <button type="submit" class="portal-btn portal-btn-primary">Cambiar contrase√±a</button>
              <span class="perfil-msg" id="perfilMsg"></span>
            </div>
          </form>
        </div>
        <div class="portal-card">
          <h3 class="portal-card-title">Backup y restauraci√≥n</h3>
          <p class="portal-card-desc">Descarga un archivo HTML con proyecto y datos. Al abrirlo en el navegador ver√°s todo integrado. Tambi√©n puedes restaurar desde HTML o JSON.</p>
          <div class="perfil-backup-actions">
            <button type="button" class="portal-btn portal-btn-primary" id="btnBackupDescargar">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
              Descargar backup HTML
            </button>
            <button type="button" class="portal-btn portal-btn-secondary" id="btnBackupCopiar" title="Copia el backup al portapapeles para pegarlo donde quieras">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
              Copiar backup
            </button>
            <button type="button" class="portal-btn portal-btn-secondary" id="btnBackupPegar" title="Pega desde el portapapeles y restaura">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>
              Pegar y restaurar
            </button>
            <label class="portal-btn portal-btn-secondary" for="perfilBackupFile">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" width="18" height="18"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
              Restaurar desde backup
            </label>
            <input type="file" id="perfilBackupFile" accept=".json,.integra-backup,.html" style="display:none">
          </div>
          <p class="perfil-backup-hint" id="perfilBackupMsg"></p>
        </div>
      </section>
    </main>
  </div>

  <!-- API: producci√≥n en Render. Para desarrollo local: window.INTEGRA_API_URL = 'http://localhost:3000'; -->
  <script>
    window.INTEGRA_API_URL = window.location.hostname === 'localhost'
      ? 'http://localhost:3000'
      : 'https://integra-e23d.onrender.com';
  </script>
  <script src="js/integra.js?v=2" defer></script>
</body>
</html>
